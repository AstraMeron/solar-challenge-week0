name: Continuous Integration

on:
  push:
    branches:
      - main
      - setup-task
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          # Fix 1: Using a specific, modern version to find pre-built wheels
          python-version: '3.11' 

      - name: Install PyArrow System Dependencies üõ†Ô∏è
        # Fixes 2 & 3: Adds the Arrow repository and installs necessary libraries
        run: |
          sudo apt-get update
          
          # Install basic tools and repository setup utilities
          sudo apt-get install -y --no-install-recommends \
            build-essential cmake pkg-config \
            software-properties-common apt-transport-https wget
          
          # Get the Ubuntu codename (e.g., jammy)
          . /etc/os-release
          
          # Add the Apache Arrow repository GPG key
          wget -O - https://apache.jfrog.io/artifactory/api/gpg/key/public | sudo apt-key add -
          
          # Add the Apache Arrow repository source list
          sudo add-apt-repository "deb https://apache.jfrog.io/artifactory/arrow/debian/${VERSION_CODENAME}/"
          
          # Update repositories again to fetch the new packages
          sudo apt-get update
          
          # Install the specific Arrow and Parquet development libraries
          sudo apt-get install -y \
            libarrow-dev \
            libparquet-dev
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Basic Check
        run: python --version