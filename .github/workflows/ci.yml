name: Continuous Integration

on:
  push:
    branches:
      - main
      - setup-task
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          # Using a specific, modern version to help find pre-built wheels
          python-version: '3.11' 

      - name: Install PyArrow System Dependencies üõ†Ô∏è
        # This step manually adds the Arrow repository to resolve "Unable to locate package" errors.
        run: |
          sudo apt-get update
          
          # 1. Install basic tools and repository setup utilities
          sudo apt-get install -y --no-install-recommends \
            build-essential cmake pkg-config \
            software-properties-common apt-transport-https wget
          
          # 2. Get the Ubuntu codename
          . /etc/os-release
          
          # Add the Apache Arrow GPG key
          wget -qO - https://apache.jfrog.io/artifactory/api/gpg/key/public | sudo apt-key add -
          
          # Manually write the repository line to the sources file
          # This avoids the "Unable to handle repository shortcut" error
          echo "deb https://apache.jfrog.io/artifactory/arrow/debian/${VERSION_CODENAME} main" | sudo tee /etc/apt/sources.list.d/apache-arrow.list
          
          # 3. Update repositories again to fetch the new packages
          sudo apt-get update
          
          # 4. Install the specific Arrow and Parquet development libraries
          sudo apt-get install -y libarrow-dev libparquet-dev
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Basic Check
        run: python --version